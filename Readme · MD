# ğŸš€ åŠ å¯†è²¨å¹£ç›£æ§ç³»çµ±

å®Œæ•´çš„åŠ å¯†è²¨å¹£æ•¸æ“šæ”¶é›†ã€åˆ†æå’Œè¦–è¦ºåŒ–ç³»çµ±

## ğŸ“‹ ç³»çµ±æ¶æ§‹

```
crypto_monitor/
â”œâ”€â”€ collectors/          # æ•¸æ“šæ”¶é›†å™¨
â”‚   â””â”€â”€ main_collector.py   # Options(æ¯«ç§’ç´š) + FR/OB(Log)æ”¶é›†
â”œâ”€â”€ database/           # è³‡æ–™åº«ç®¡ç†
â”‚   â””â”€â”€ db_init.py          # è³‡æ–™åº«åˆå§‹åŒ–ï¼ˆæ™‚é–“åˆ†ç‰‡ï¼‰
â”œâ”€â”€ scripts/            # å·¥å…·è…³æœ¬
â”‚   â””â”€â”€ analyze_logs.py     # Logåˆ†æï¼ˆ14å¤©/7å¤©çµ±è¨ˆï¼‰
â”œâ”€â”€ frontend/           # å‰ç«¯ç¶²ç«™
â”‚   â”œâ”€â”€ index.html          # BootstrapéŸ¿æ‡‰å¼ä»‹é¢
â”‚   â”œâ”€â”€ dashboard.js        # å‰ç«¯é‚è¼¯
â”‚   â””â”€â”€ api_server.py       # FastAPIå¾Œç«¯
â”œâ”€â”€ grafana/            # Grafanaé…ç½®
â”‚   â””â”€â”€ dashboard.json      # æ¨¹ç‹€åœ–+ç·šåœ–çµ„åˆ
â””â”€â”€ logs/               # Logæª”æ¡ˆç›®éŒ„
    â”œâ”€â”€ fr_ob_metrics.log    # FR & OB Log
    â”œâ”€â”€ options_metrics.log   # Optionså‚™ä»½Log
    â””â”€â”€ system.log           # ç³»çµ±Log
```

## ğŸ¯ åŠŸèƒ½ç‰¹è‰²

### 1ï¸âƒ£ **æ•¸æ“šæ”¶é›†**
- âœ… **Options Greeks**: æ¯«ç§’ç´š (100ms) æ”¶é›†ï¼Œç›´æ¥å¯«å…¥è³‡æ–™åº«
- âœ… **Funding Rate**: æ¯ 5 ç§’æ”¶é›†ï¼Œè¨˜éŒ„åˆ° Log
- âœ… **Order Book Spread**: æ¯ 5 ç§’æ”¶é›†ï¼Œè¨˜éŒ„åˆ° Log

### 2ï¸âƒ£ **è³‡æ–™åº«è¨­è¨ˆ**
- âœ… **æ™‚é–“åˆ†ç‰‡**: Options æ•¸æ“šæŒ‰æ—¥æœŸåˆ†è¡¨ (`options_greeks_YYYYMMDD`)
- âœ… **çµ±è¨ˆè¡¨**: è‡ªå‹•è¨ˆç®— 7å¤©/14å¤© æœ€å¤§æœ€å°å€¼
- âœ… **PostgreSQL**: é«˜æ•ˆèƒ½æ™‚åºæ•¸æ“šå„²å­˜

### 3ï¸âƒ£ **å‰ç«¯ä»‹é¢**
- âœ… **Bootstrap 5**: ç¾ä»£åŒ–éŸ¿æ‡‰å¼è¨­è¨ˆ
- âœ… **RWD**: å®Œæ•´çš„æ‰‹æ©Ÿ/å¹³æ¿/æ¡Œé¢æ”¯æ´
- âœ… **Chart.js**: äº’å‹•å¼åœ–è¡¨
- âœ… **å³æ™‚æ›´æ–°**: æ¯ 30 ç§’è‡ªå‹•åˆ·æ–°

### 4ï¸âƒ£ **Grafana è¦–è¦ºåŒ–**
- âœ… **æ¨¹ç‹€åœ–**: Options Greeks åˆ†å±¤å±•ç¤º
- âœ… **ç·šåœ–**: FR/OB/IV è¶¨å‹¢åˆ†æ
- âœ… **çµ„åˆåœ–è¡¨**: å¤šç¶­åº¦æ•¸æ“šå°æ¯”

## ğŸ”§ ç’°å¢ƒéœ€æ±‚

### å¿…è¦è»Ÿé«”
```bash
# Python 3.8+
python --version

# PostgreSQL 12+
psql --version

# Node.js (å¯é¸ï¼Œç”¨æ–¼å‰ç«¯é–‹ç™¼)
node --version
```

### Python å¥—ä»¶
```bash
pip install ccxt psycopg2-binary fastapi uvicorn --break-system-packages
```

## ğŸ“¦ å®‰è£æ­¥é©Ÿ

### Step 1: å®‰è£ PostgreSQL
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install postgresql postgresql-contrib

# macOS
brew install postgresql

# å•Ÿå‹•æœå‹™
sudo systemctl start postgresql
```

### Step 2: å»ºç«‹è³‡æ–™åº«
```bash
# åˆ‡æ›åˆ° postgres ç”¨æˆ¶
sudo -u postgres psql

# å»ºç«‹è³‡æ–™åº«å’Œç”¨æˆ¶
CREATE DATABASE crypto_metrics;
CREATE USER crypto_user WITH PASSWORD 'your_secure_password';
GRANT ALL PRIVILEGES ON DATABASE crypto_metrics TO crypto_user;
\q
```

### Step 3: æ›´æ–°é…ç½®
ç·¨è¼¯æ‰€æœ‰ Python æª”æ¡ˆä¸­çš„ `DB_CONFIG`:
```python
DB_CONFIG = {
    "host": "localhost",
    "port": 5432,
    "database": "crypto_metrics",
    "user": "crypto_user",      # æ”¹æˆä½ çš„ç”¨æˆ¶å
    "password": "your_password"  # æ”¹æˆä½ çš„å¯†ç¢¼
}
```

### Step 4: åˆå§‹åŒ–è³‡æ–™åº«
```bash
cd /home/claude/crypto_monitor
python database/db_init.py init
```

## ğŸš€ å•Ÿå‹•ç³»çµ±

### 1. å•Ÿå‹•æ•¸æ“šæ”¶é›†å™¨
```bash
# åœ¨ç¬¬ä¸€å€‹çµ‚ç«¯æ©Ÿ
python collectors/main_collector.py
```

è¼¸å‡ºç¯„ä¾‹:
```
============================================================
ğŸš€ åŠ å¯†è²¨å¹£æ•¸æ“šæ”¶é›†ç³»çµ±å•Ÿå‹•
============================================================
ğŸ“ Log ç›®éŒ„: /home/claude/crypto_monitor/logs
ğŸ“Š Options é–“éš”: 100 ms
ğŸ“Š FR/OB é–“éš”: 5 ç§’
============================================================
âœ… æ‰€æœ‰æ”¶é›†å™¨å·²å•Ÿå‹•
æŒ‰ Ctrl+C åœæ­¢...
```

### 2. åŸ·è¡Œ Log åˆ†æï¼ˆå®šæœŸåŸ·è¡Œï¼‰
```bash
# åœ¨ç¬¬äºŒå€‹çµ‚ç«¯æ©Ÿï¼Œå»ºè­°æ¯å¤©åŸ·è¡Œä¸€æ¬¡
python scripts/analyze_logs.py
```

é€™æœƒè¨ˆç®—ä¸¦å„²å­˜:
- âœ… 7å¤©å’Œ14å¤©çš„ FR æœ€å¤§æœ€å°å€¼
- âœ… 7å¤©å’Œ14å¤©çš„ Spread æœ€å¤§æœ€å°å€¼
- âœ… 7å¤©å’Œ14å¤©çš„ Options Greeks çµ±è¨ˆ

### 3. å•Ÿå‹•å‰ç«¯ API ä¼ºæœå™¨
```bash
# åœ¨ç¬¬ä¸‰å€‹çµ‚ç«¯æ©Ÿ
python frontend/api_server.py
```

å‰ç«¯ç¶²ç«™: http://localhost:8000/static/index.html
API æ–‡æª”: http://localhost:8000/docs

### 4. è¨­å®š Grafanaï¼ˆå¯é¸ä½†æ¨è–¦ï¼‰

#### å®‰è£ Grafana
```bash
# Ubuntu/Debian
sudo apt-get install -y adduser libfontconfig1
wget https://dl.grafana.com/oss/release/grafana_10.0.0_amd64.deb
sudo dpkg -i grafana_10.0.0_amd64.deb
sudo systemctl start grafana-server

# macOS
brew install grafana
brew services start grafana
```

#### é…ç½® Grafana
1. é–‹å•Ÿ Grafana: http://localhost:3000
2. é è¨­å¸³å¯†: `admin` / `admin`
3. æ–°å¢ Data Source:
   - Type: PostgreSQL
   - Host: `localhost:5432`
   - Database: `crypto_metrics`
   - User: `crypto_user`
   - Password: `your_password`
   - SSL Mode: `disable`

4. åŒ¯å…¥ Dashboard:
   - é»é¸ "+" â†’ "Import"
   - ä¸Šå‚³ `grafana/dashboard.json`
   - é¸æ“‡å‰›å»ºç«‹çš„ PostgreSQL data source
   - é»é¸ "Import"

## ğŸ“Š ä½¿ç”¨æŒ‡å—

### å‰ç«¯åŠŸèƒ½

#### 1. å„€è¡¨æ¿é¦–é 
- å¿«é€Ÿçµ±è¨ˆå¡ç‰‡: BTC FR, BTC Spread, Options IV, Delta
- ç³»çµ±ç‹€æ…‹: é‹è¡Œç‹€æ…‹ã€æœ€å¾Œæ›´æ–°æ™‚é–“ã€ç¸½è¨˜éŒ„æ•¸

#### 2. Funding Rate å€å¡Š
- **è¶¨å‹¢åœ–**: 14å¤© FR è¶¨å‹¢
- **çµ±è¨ˆè¡¨**: 7å¤© vs 14å¤© æœ€å¤§æœ€å°å€¼å°æ¯”

#### 3. Order Book Spread å€å¡Š
- **è¶¨å‹¢åœ–**: 14å¤© Spread è¶¨å‹¢
- **çµ±è¨ˆè¡¨**: å¹³å‡/æœ€å¤§/æœ€å° Spread

#### 4. Options Greeks å€å¡Š
- **IV è¶¨å‹¢åœ–**: éš±å«æ³¢å‹•ç‡è®ŠåŒ–
- **Greeks é›·é”åœ–**: Delta/Gamma/Vega/Theta/Rho åˆ†å¸ƒ

#### 5. Grafana æ•´åˆ
- é»é¸æŒ‰éˆ•ç›´æ¥é–‹å•Ÿ Grafana å®Œæ•´è¦–è¦ºåŒ–

### Grafana åŠŸèƒ½

#### æ¨¹ç‹€åœ–ï¼ˆBar Gaugeï¼‰
é¡¯ç¤ºæ¯å€‹ Options åˆç´„çš„ Greeks å€¼:
- Delta: åƒ¹æ ¼æ•æ„Ÿåº¦
- Gamma: Delta è®ŠåŒ–ç‡
- Vega: æ³¢å‹•ç‡æ•æ„Ÿåº¦
- Theta: æ™‚é–“è¡°æ¸›

#### ç·šåœ–çµ„åˆ
- FR è¶¨å‹¢: å¤šäº¤æ˜“æ‰€å°æ¯”
- Spread è¶¨å‹¢: æµå‹•æ€§åˆ†æ
- IV è¶¨å‹¢: å¸‚å ´æƒ…ç·’æŒ‡æ¨™

## ğŸ› ï¸ ç¶­è­·ä»»å‹™

### æ¯æ—¥ç¶­è­·
```bash
# 1. åŸ·è¡Œ Log åˆ†æï¼ˆå»ºè­°åœ¨å‡Œæ™¨åŸ·è¡Œï¼‰
0 1 * * * python /path/to/crypto_monitor/scripts/analyze_logs.py

# 2. å»ºç«‹æœªä¾†åˆ†ç‰‡è¡¨
0 2 * * * python /path/to/crypto_monitor/database/db_init.py prepare 7

# 3. æ¸…ç† 30 å¤©å‰çš„èˆŠè¡¨
0 3 * * 0 python /path/to/crypto_monitor/database/db_init.py cleanup 30
```

### ç›£æ§æª¢æŸ¥
```bash
# æª¢æŸ¥æ”¶é›†å™¨ç‹€æ…‹
ps aux | grep main_collector.py

# æª¢æŸ¥ Log æª”æ¡ˆå¤§å°
ls -lh logs/

# æª¢æŸ¥è³‡æ–™åº«é€£ç·š
python -c "import psycopg2; conn = psycopg2.connect(host='localhost', database='crypto_metrics', user='crypto_user', password='your_password'); print('âœ… é€£ç·šæˆåŠŸ')"
```

## ğŸ“ˆ æ•¸æ“šæµç¨‹

```
1. æ”¶é›†éšæ®µ:
   Options (100ms) â†’ PostgreSQL (options_greeks_YYYYMMDD)
   FR/OB (5s) â†’ Logæª”æ¡ˆ (fr_ob_metrics.log)

2. åˆ†æéšæ®µ:
   Logæª”æ¡ˆ â†’ analyze_logs.py â†’ çµ±è¨ˆè¡¨
   - funding_rate_stats (7d/14d)
   - orderbook_spread_stats (7d/14d)
   - options_greeks_stats (7d/14d)

3. å±•ç¤ºéšæ®µ:
   çµ±è¨ˆè¡¨ â†’ FastAPI â†’ å‰ç«¯/Grafana
```

## ğŸ” æ•…éšœæ’é™¤

### å•é¡Œ 1: è³‡æ–™åº«é€£ç·šå¤±æ•—
```bash
# æª¢æŸ¥ PostgreSQL æ˜¯å¦é‹è¡Œ
sudo systemctl status postgresql

# æ¸¬è©¦é€£ç·š
psql -h localhost -U crypto_user -d crypto_metrics
```

### å•é¡Œ 2: Options æ”¶é›†å¤±æ•—
```bash
# æª¢æŸ¥ ccxt ç‰ˆæœ¬
pip show ccxt

# æ¸¬è©¦ Deribit é€£ç·š
python -c "import ccxt; ex = ccxt.deribit(); print(ex.fetch_ticker('BTC-30JAN26-90000-C'))"
```

### å•é¡Œ 3: å‰ç«¯ç„¡æ³•é¡¯ç¤ºæ•¸æ“š
```bash
# æª¢æŸ¥ API å¥åº·ç‹€æ…‹
curl http://localhost:8000/api/health

# æª¢æŸ¥ç€è¦½å™¨ Console æ˜¯å¦æœ‰éŒ¯èª¤
```

### å•é¡Œ 4: Grafana ç„¡æ•¸æ“š
```bash
# æ¸¬è©¦ PostgreSQL Data Source
# åœ¨ Grafana â†’ Configuration â†’ Data Sources â†’ é»é¸ Test

# æª¢æŸ¥è¡¨æ˜¯å¦å­˜åœ¨
psql -h localhost -U crypto_user -d crypto_metrics -c "\dt"
```

## ğŸ“ API ç«¯é»

### åŸºæœ¬ç«¯é»
- `GET /` - API ç‹€æ…‹
- `GET /api/health` - å¥åº·æª¢æŸ¥

### æ•¸æ“šç«¯é»
- `GET /api/funding-rate-stats?days=14` - FR çµ±è¨ˆ
- `GET /api/spread-stats?days=14` - Spread çµ±è¨ˆ
- `GET /api/options-stats?days=7` - Options çµ±è¨ˆ
- `GET /api/quick-metrics` - å¿«é€ŸæŒ‡æ¨™
- `GET /api/options-realtime?limit=100` - å³æ™‚ Options

### æŸ¥è©¢åƒæ•¸
```
days: å¤©æ•¸ (7 æˆ– 14)
exchange: äº¤æ˜“æ‰€ç¯©é¸ (binance, mexc)
symbol: äº¤æ˜“å°ç¯©é¸ (BTC/USDT)
limit: é™åˆ¶ç­†æ•¸
```

## ğŸ¨ è‡ªè¨‚ä¿®æ”¹

### ä¿®æ”¹æ”¶é›†é–“éš”
ç·¨è¼¯ `collectors/main_collector.py`:
```python
FR_OB_INTERVAL = 5          # FR/OB é–“éš”ï¼ˆç§’ï¼‰
OPTIONS_INTERVAL_MS = 100   # Options é–“éš”ï¼ˆæ¯«ç§’ï¼‰
```

### æ–°å¢äº¤æ˜“æ‰€
```python
EXCHANGES = ["mexc", "binance", "okx"]  # æ–°å¢ okx
```

### æ–°å¢äº¤æ˜“å°
```python
SPOT_SYMBOLS = ["BTC/USDT", "ETH/USDT", "SOL/USDT"]
```

### æ–°å¢ Options åˆç´„
```python
OPTIONS_SYMBOLS = [
    "BTC-30JAN26-90000-C",
    "BTC-30JAN26-90000-P",
    "ETH-30JAN26-3000-C",  # æ–°å¢
]
```

## ğŸ” å®‰å…¨å»ºè­°

1. **è³‡æ–™åº«å¯†ç¢¼**: ä½¿ç”¨å¼·å¯†ç¢¼ä¸¦å®šæœŸæ›´æ›
2. **API èªè­‰**: åœ¨ç”Ÿç”¢ç’°å¢ƒåŠ å…¥ JWT èªè­‰
3. **é˜²ç«ç‰†**: é™åˆ¶è³‡æ–™åº«å’Œ API çš„è¨ªå•
4. **å‚™ä»½**: å®šæœŸå‚™ä»½è³‡æ–™åº«

## ğŸ“ æŠ€è¡“æ”¯æ´

å¦‚æœ‰å•é¡Œ,è«‹è¯çµ¡:
- **é–‹ç™¼åœ˜éšŠ**: IVT PD1 Department
- **æŠ€è¡“è² è²¬äºº**: Dennis
- **Email**: [your-email]

## ğŸ“œ æˆæ¬Š

Internal Use Only - IVT Company

---

**ç‰ˆæœ¬**: 1.0.0
**æœ€å¾Œæ›´æ–°**: 2024-12-12
